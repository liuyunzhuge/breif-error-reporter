!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).EventReporter=n()}(this,function(){"use strict";function c(e,n){return Object.prototype.toString.call(e)==="[object "+(n||"Object")+"]"}function e(e,n){var o,r,t;r=!1,(o=document.createElement("script")).type="text/javascript",o.src=e,o.onload=o.onreadystatechange=function(){r||this.readyState&&"complete"!==this.readyState||(r=!0,c(n,"Function")&&n())},(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(o,t)}function n(){if(f.vue){var r=f.vue.config.errorHandler;f.vue.config.errorHandler=function(e,n,o){return console.error(e),u(e,l.VUE),c(r,"Function")&&r(e,n,o)}}if(f.vueRouter&&f.vueRouter.onError(function(e){console.error(e),u(e,l.VUE_ROUTER)}),f.axios){var n=function(e,n){console.error(n);function o(e){return e.notToReport=!0,Promise.reject(e)}var r,t,i=f.axiosIgnore,a=n.config;if(i){if(c(i,"Array")&&i.some(function(e){return RegExp(e).test(a.url)}))return o(n);if(c(i,"Function")&&i(n))return o(n)}return u(n,e,(r=a,t={},(f.axiosReportConfig||["url","method","params","data","headers"]).forEach(function(e){t[e]=r[e]}),t)),o(n)};f.axios.interceptors.request.use(function(e){return e},function(e){return n(l.AXIOS_REQUEST,e)}),f.axios.interceptors.response.use(function(e){return e},function(e){return n(l.AXIOS_RESPONSE,e)})}}function s(n){if(!n)return!1;if(n instanceof Error){if(n.notToReport)return!0;if(f.notReportErrors.some(function(e){return n instanceof e}))return!0}return!1}function u(e,n){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=e;if(c(e,"String")&&(r=Error(e)),!s(r))return f.onReport.call(d,f.processStack(r),n||l.MANUAL,o)}function o(){}var l={RUNTIME:"runtime",RESOURCE:"resource",VUE:"vue",VUE_ROUTER:"vue-router",MANUAL:"manual",AXIOS_REQUEST:"axios-request",AXIOS_RESPONSE:"axios-response",UNHANDLED_REJECTION:"unhandledrejection"},f={vConsoleSrc:"//cdn.bootcss.com/vConsole/3.3.4/vconsole.min.js",maximumStackLines:20,resource:!0,unhandledRejection:!0,vue:null,vueRouter:null,axios:null,axiosReportConfig:null,axiosIgnore:null,notReportErrors:[],processStack:function(e){var n=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,f.maximumStackLines).join("@").replace(/\?[^:]+/gi,""),o=""+e;return~n.indexOf(o)||(n=o+"@"+n),n},onReport:o,onResourceLoadError:o},r=null,t=[],i=!0,d={setConfig:function(e){var a;Object.assign(f,e),a=window.onerror,window.onerror=function(e,n,o,r,t){var i=e;if(!s(t))return t&&t.stack&&(i=f.processStack(t)),~e.toLowerCase().indexOf("script error")?console.error("Script Error: See Browser Console for Detail"):f.onReport.call(d,i,l.RUNTIME),!!c(a,"Function")&&a.call(this,e,n,o,r,t)},f.resource&&window.addEventListener("error",function(e){if(e.target&&(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement)){var n="--"+e.type+"--"+e.target.tagName.toLowerCase()+"::"+(e.target.src||e.target.href);f.onResourceLoadError.call(d,e),f.onReport.call(d,n,l.RESOURCE)}},!0),n(),f.unhandledRejection&&window.addEventListener("unhandledrejection",function(e){void 0!==e.reason&&u(e.reason instanceof Error?e.reason:e.reason+"",l.UNHANDLED_REJECTION)})},enableVConsole:function(o){if(r&&o)return r.show();e(f.vConsoleSrc,function(){r=r||new VConsole({defaultPlugins:["system","network","element","storage"],maxLogNumber:5e3,onReady:function(){o&&setTimeout(function(){return r.show()},0)}}),i=!1;for(var e=t.length,n=0;n<e;n++)t[n].noOrigin=!0,r.pluginList.default.printLog(t[n]);t=[]})},loadScript:e,getSystemInfo:function(){var e=navigator.userAgent,n=e.match(/(ipod).*\s([\d_]+)/i),o=e.match(/(ipad).*\s([\d_]+)/i),r=e.match(/(iphone)\sos\s([\d_]+)/i),t=e.match(/(android)\s([\d\.]+)/i),i="Unknown",a="";t?(i="Android",a=t[2]):r?(i="iPhone",a="iOS"+r[2].replace(/_/g,".")):o?(i="iPad",a="iOS"+o[2].replace(/_/g,".")):n&&(i="iPod",a="iOS"+n[2].replace(/_/g,"."));var c=e.match(/MicroMessenger\/([\d\.]+)/i),s=!1,u="",l=!1;c&&c[1]&&(s=!0,u=c[1],"miniprogram"!==window.__wxjs_environment&&!/miniProgram/i.test(e)||(l=!0));var f=e.toLowerCase().match(/ nettype\/([^ ]+)/g),d="Unknown";return f&&f[0]&&(d=(f=f[0].split("/"))[1]),{system:i,systemVersion:a,netType:d,ua:e,wechat:s,wechatVersion:u,wechatMini:l}},getCookie:function(e){var n=encodeURIComponent(e).replace(/[-.+*]/g,"\\$&"),o=RegExp("(?:(?:^|.*;)\\s*".concat(n,"\\s*\\=\\s*([^;]*).*$)|^.*$"));return decodeURIComponent(document.cookie.replace(o,"$1"))||null},makeReport:u,wrapNotReport:function(e){return e instanceof Error&&(e.notToReport=!0),e}};return["log","info","warn","debug","error"].forEach(function(e){var n=console[e];console[e]=function(){return i&&t.push({logType:e,logs:arguments}),n.apply(console,arguments)}}),d});
